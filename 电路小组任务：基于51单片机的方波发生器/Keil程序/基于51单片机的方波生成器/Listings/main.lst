C51 COMPILER V9.60.7.0   MAIN                                                              12/16/2025 16:03:25 PAGE 1   


C51 COMPILER V9.60.7.0, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN .\Objects\main.obj
COMPILER INVOKED BY: D:\keil5\C51\BIN\C51.EXE main.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Listings\main.l
                    -st) OBJECT(.\Objects\main.obj)

line level    source

   1          #include <reg52.h>
   2          
   3          sbit PWM_OUT = P2^0; // PWM输出引脚
   4          
   5          unsigned int Timer0_Reload; // 定时器0重载值 (控制高电平时间)
   6          unsigned int Timer1_Reload; // 定时器1重载值 (控制低电平时间)
   7          
   8          // 定时器0初始化
   9          void Timer0_Init(void)
  10          {
  11   1          TMOD &= 0xF0; // 清空定时器0模式位
  12   1          TMOD |= 0x01; // 定时器0工作在模式1
  13   1          // 定时器0中断使能
  14   1          ET0 = 1;
  15   1          // 总中断使能
  16   1          EA = 1;
  17   1      }
  18          
  19          // 定时器1初始化
  20          void Timer1_Init(void)
  21          {
  22   1          TMOD &= 0x0F; // 清空定时器1模式位
  23   1          TMOD |= 0x10; // 定时器1工作在模式1 (16位自动重装)
  24   1          // 定时器1中断使能
  25   1          ET1 = 1;
  26   1          // 总中断使能
  27   1          EA = 1;
  28   1      }
  29          
  30          /**
  31           * @brief 
  32           * @param period 周期
  33           * @param duty_cycle 占空比
  34           */
  35          void Set_PWM_Params(unsigned int period, unsigned char duty_cycle)
  36          {
  37   1          unsigned long temp;
  38   1              // 防止错误参数
  39   1          if (period == 0) period = 1;
  40   1          if (duty_cycle > 100) duty_cycle = 100;
  41   1          if (duty_cycle == 0) 
  42   1          {
  43   2              PWM_OUT = 0;
  44   2              return;
  45   2          }
  46   1          if (duty_cycle == 100) 
  47   1          {
  48   2              PWM_OUT = 1;
  49   2              return;
  50   2          }
  51   1          
  52   1          // 计算高电平时间和低电平时间
  53   1          // 高电平计数值 = (周期 * 占空比) / 100
  54   1          temp = (unsigned long)period * duty_cycle;
C51 COMPILER V9.60.7.0   MAIN                                                              12/16/2025 16:03:25 PAGE 2   

  55   1          Timer0_Reload = 65536 - (temp / 100); // 定时器0控制高电平
  56   1          // 低电平计数值 = 周期 - 高电平计数值
  57   1          temp = (unsigned long)period * (100 - duty_cycle);
  58   1          Timer1_Reload = 65536 - (temp / 100); // 定时器1控制低电平
  59   1          // 启动第一个周期
  60   1          PWM_OUT = 1; // 先输出高电平
  61   1          // 装载并启动定时器0
  62   1          TH0 = (unsigned char)(Timer0_Reload >> 8);
  63   1          TL0 = (unsigned char)Timer0_Reload;
  64   1          TR0 = 1; // 启动定时器0
  65   1      }
  66          
  67          // 定时器0中断服务函数（高->低）
  68          void Timer0_ISR(void) interrupt 1
  69          {
  70   1          PWM_OUT = 0; // 切换到低电平
  71   1          TR0 = 0; // 关闭定时器0
  72   1          // 装载并启动定时器1 (低电平时间)
  73   1          TH1 = (unsigned char)(Timer1_Reload >> 8);
  74   1          TL1 = (unsigned char)Timer1_Reload;
  75   1          TR1 = 1; // 启动定时器1
  76   1      }
  77          
  78          // 定时器1中断服务函数（低->高）
  79          void Timer1_ISR(void) interrupt 3
  80          {
  81   1          PWM_OUT = 1; // 切换到高电平
  82   1          TR1 = 0; // 关闭定时器1    
  83   1          // 装载并启动定时器0 (高电平时间)
  84   1          TH0 = (unsigned char)(Timer0_Reload >> 8);
  85   1          TL0 = (unsigned char)Timer0_Reload;
  86   1          TR0 = 1; // 启动定时器0
  87   1      }
  88          
  89          // 主函数
  90          void main(void)
  91          {
  92   1          unsigned int pwm_period = 2000; // PWM周期（1->1us）
  93   1          unsigned char pwm_duty = 20;    // PWM占空比
  94   1          Timer0_Init();
  95   1          Timer1_Init();
  96   1          // 设置并启动PWM
  97   1          Set_PWM_Params(pwm_period, pwm_duty); 
  98   1          while(1)
  99   1          {
 100   2              
 101   2          }
 102   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    205    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      4       3
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
